<html>
<head>
  <title></title>
  <script src="https://cdn.rawgit.com/konvajs/konva/0.9.0/konva.min.js"></script>
  <script src="http://code.jquery.com/jquery-2.1.3.min.js" charset="utf-8"></script>

</head>
<body style="background-image:url('http://juliewight.com/wp-content/uploads/2013/11/cool-water-backgrounds.jpg')">
  <header> <h2 style="color:orange">Drag the Sea Lion</h2> </header>
  <div id="container"></div>
</body>
<script>
var stage = new Konva.Stage({
  container: 'container',
      width: window.innerWidth -100,//window.innerWidth,
      height: window.innerHeight - 100,
    });

var layer = new Konva.Layer();

var seaLion = new Image();
var masha = new Image();

seaLion.src = "http://i.imgur.com/8zCHuXx.jpg";
masha.src = "https://avatars2.githubusercontent.com/u/709758?v=3&s=400";

var player = new Konva.Image({
  x: 0,
  y: stage.getHeight() / 2,
  image: seaLion,
  width: 100,
  height: 100,
  fill: "red",
  stroke: "black",
  strokeWidth: 5,
  draggable: true,
  dragBoundFunc: function(pos) {
    return {
        x: pos.x,
        y: this.getAbsolutePosition().y
    }
  }
});


var obstacleOne = new Konva.Rect({
  x: stage.getWidth() / 2,
  y: stage.getHeight() / 2,
  image: masha,
  width: 100,
  height: 100,
  fill: "green",
  stroke: "black",
  strokeWidth: 5,
      // draggable: true,
    });

var obstacleTwo = new Konva.Rect({
  x: stage.getWidth() / 4.9,
  y: stage.getHeight() / 2,
  image: masha,
  width: 400,
  height: 400,
  fill: "blue",
  stroke: "black",
  strokeWidth: 5,
      // draggable: true,
    });

var obstacleThree = new Konva.Rect({
  x: stage.getWidth() / 1.5,
  y: stage.getHeight() / 2,
  width: 100,
  height: 100,
  fill: "orange",
  stroke: "black",
  strokeWidth: 5,
      // draggable: true,
    });

var obstacleFour = new Konva.Rect({
  x: stage.getWidth() / 1.35,
  y: stage.getHeight() / 2,
  width: 100,
  height: 100,
  fill: "black",
  stroke: "orange",
  strokeWidth: 5,
      // draggable: true,
    });

var winField = new Konva.Rect({
  x: stage.getWidth() -200,
  y: 0,
  width: 100,
  height: stage.getHeight(),
  fill: "red",
  stroke: "black",
  strokeWidth: 5,
      // draggable: true,
    });


layer.add(player, obstacleOne, obstacleTwo, obstacleThree, obstacleFour, winField);
// movinlayer.add(obstacleOne);


stage.add(layer);
// stage.add(movinlayer);

var amplitude = 300;
var period = 2000;

var amplitude2 = 400;
var period2 = 1500;

var amplitude3 =450;
var period3 = 1000;

var amplitude4 =450;
var period4 = 700;

var centerX = stage.getWidth() / 2;
var centerY = stage.getHeight() / 2;

var anim = new Konva.Animation(function(frame){
    obstacleOne.setY(amplitude * Math.sin(frame.time * 2 * Math.PI / period) + centerY);
    obstacleTwo.setY(amplitude2 * Math.sin(frame.time * 2 * Math.PI / period2) + centerY);
    obstacleThree.setY(amplitude3 * Math.sin(frame.time * 2 * Math.PI / period3) + centerY);
    obstacleFour.setY(amplitude4 * Math.sin(frame.time * 2 * Math.PI / period4) + centerY);

}, layer);

function checkcontain(){
  if (contains(player, obstacleOne)){
    youLose();
  }
  if (contains(player, obstacleTwo)){
      youLose();
  }
  if (contains(player, obstacleThree)){
      youLose();
  }
  if (contains(player, obstacleFour)){
      youLose();
  }
  if (contains(player, winField)){
    alert("WIN!!!!!!!!!!!!!");
    anim.stop();
    $('body').append("<h1 style='position: absolute; top: 5%; color: yellow;'>You Won!!!</h2>")
    clearInterval(interval);
  }
}

var interval = setInterval(checkcontain,1)


// function youLose(){
//   $('body').append("<h1 style='position: absolute; top: 0%'>You Lost Sucker!!!</h2>");
//   anim.stop();
//   clearInterval(interval);
// };

function youLose(){
  $('body').append("<h1 style='position: absolute; top: 5%; color:yellow;'>You Lost Sucker!!!</h2>");
  anim.stop();
  clearInterval(interval);
};

anim.start();



function contains(targetA, targetB) {
  return !(targetB.x() > (targetA.x() + targetA.width()) ||
   (targetB.x() + targetB.width()) < targetA.x() ||
   targetB.y() > (targetA.y() + targetA.height()) ||
   (targetB.y() + targetB.height()) < targetA.y());

     // return ((targetA.x)<(targetB.x) || (targetA.x+targetA.width < targetB.x+targetB.width))
     // return (targetA.x+targetA.width > targetB.x)
   }

   </script>
